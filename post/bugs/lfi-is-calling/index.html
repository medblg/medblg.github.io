<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>From academic research to LFD critical vulnerability | MedBLG - InfoSec Enthusiast | Dev - DevOps - AI</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.2/css/all.css">
    
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <meta property="og:title" content="From academic research to LFD critical vulnerability" />
<meta property="og:description" content="Local file include can be used by developers to retrieve files in the current working directory, however when an attacker locate the vulnerable endpoint, he can jump directories to read sensitive system files And this what happens when I was conducting my usual academic work till observing this LFI !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://medblg.top/post/bugs/lfi-is-calling/" />
<meta property="og:image" content="https://medblg.top/images/bGZpLWlzLWNhbGxpbmcK.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="article:published_time" content="2020-10-21T12:46:39+01:00" />
<meta property="article:modified_time" content="2020-10-21T12:46:39+01:00" />

  </head>

  <body>
    
    <div class="progress-container">
      <div class="progress-bar" id="myBar"></div>
    </div>  
    <nav>
    <ul class="menu">
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/">Posts</a></li>
      
      <li><a href="/categories">Categories</a></li>
      
      <li><a href="/tags">Tags</a></li>
      
    </ul>

    <ul class="menu" id="social-links">
    
      <li><a href="https://fb.me/simo.balghaoui"><i class="fa-brands fa-facebook fa-2xl"></i></a></li>

      <li><a href="https://github.com/medblg"><i class="fa-brands fa-github fa-2xl"></i></a></li>

      <li><a href="https://linkedin.com/in/medblg"><i class="fa-brands fa-linkedin-in fa-2xl"></i></a></li>

    </ul>
    
    </div>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">From academic research to LFD critical vulnerability</span></h1>

<h2 class="date">Oct. 21, 2020</h2>
</div>


<main>
<figure>
<img class="featured_img" src="/images/bGZpLWlzLWNhbGxpbmcK.png" width="600px" height="350px"/> 
    <figcaption style="margin-top:10px;font-family: sohne, 'Helvetica Neue', Helvetica, Arial, sans-serif;color: rgba(117, 117, 117, 1)">
    Vulnerable discovered code LFI
    </figcaption></figure>
<h3 id="intro">Intro:</h3>
<p>Three years ago, while conducting my academic research. I come accross a website to download an interresting pdf course.</p>
<p>I downloaded the pdf, and as always, the nerd come back to mind whenever had the chance, even if it’s not the subject of my research. So, I tried to test the website for what it seems to me a vulnerability. And guess what? it’s a critical one.</p>
<p>The website was affected by <code>LFD</code> (Local File Download). Instead of downloading the pdf course, a simple level back <code>../</code> can traverse directory back to its parent, to download any local file on that website.
I just need to specify the correct <code>webroot</code>. It’s a piece of cake as, we had only to read the 
<u>index.php</u> to reveal the correct webroot path and other interesting information includes the database credentials…! It was easy to read the full database and get all the source source, this can be automated to grab the full source code.</p>
<p>Let us inspect the vulnerable part of the file:
I targeted the vulnerable code to analyze, and I got 3 php lines of code described below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#ff79c6">&lt;?</span>php 
</span></span><span style="display:flex;"><span>header(“Content<span style="color:#ff79c6">-</span>type<span style="color:#ff79c6">:</span> application<span style="color:#ff79c6">/</span>pdf”); 
</span></span><span style="display:flex;"><span>header(“Content<span style="color:#ff79c6">-</span>Disposition<span style="color:#ff79c6">:</span> attachment; filename<span style="color:#ff79c6">=</span>upload<span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">$_GET</span>[pdf]”); 
</span></span><span style="display:flex;"><span>readfile(<span style="color:#8be9fd;font-style:italic">$_GET</span>[‘pdf’]); 
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">?&gt;</span>
</span></span></code></pre></div><h3 id="code-review">Code review:</h3>
<ul>
<li><code>header()</code> is used to send a raw HTTP header.</li>
<li>The first line specifies the delivered content type <code>Content-type:application/pdf</code>.</li>
<li>The second line, forces the file to be treated as attachement, and thus downloaded, not rendered. The filename attribute is the recommended name when saving the file.</li>
<li>The vulnerable part was actually the last line, a clear <code>readfile()</code> function that takes the value of the pdf argument 
<u>without any sanitization</u>.</li>
</ul>
<h3 id="exploitation">Exploitation:</h3>
<p>Simple call to : site.tld/endpoint.php?pdf=<code>../../../etc/passwd</code> will download all server users ! in a normal webroot <code>/home/user/[public_html]/</code>.</p>
<h3 id="sum-up">Sum up</h3>
<p>The two lines are sent to the server as headers and the third one feeds the readfile function with the pdf parameter value.</p>
<p>With these three lines, I was able to get through many websites source code, using the vulnerable endpoint and with just a simple <code>google dorking</code>, I was amazed how many websites used that vulnerable endpoint, guess the same developer.
Even big companies were vulnerable, Till now while rewriting this!. I contacted the developer and was managed to remediate the issue !</p>
<h4 id="refs">Refs:</h4>
<p>#<a href="http://www.faqs.org/rfcs/rfc2616.html">Hypertext Transfer Protocol &ndash; HTTP/1.1</a>
#<a href="https://www.php.net/manual/en/function.header.php">PHP - Header</a></p>

	
<a class="tag" href="/tags/lfi">#lfi</a>
	
<a class="tag" href="/tags/php_sec">#php_sec</a>

</main>
<aside>
<div class="latest-posts">
    <h3 style="text-align: center;">
        Category: 
        
        <a class="cat" href="/categories/bugs">
            bugs
        </a>
        
    </h3>
    <ul>
        
            
            
       <table>
            
            
             
        <tr>
            <th><li style="list-style: none;"><span>Next</span>: </th><td><a href="https://medblg.top/post/bugs/strongkey-rce/">Struts your way into Strongkey [RCE]</a></li></td>
            
        </tr>
            
            
            
        <tr>
            <th><li style="list-style: none;"><span>Previous</span>: </th><td><a href="https://medblg.top/post/bugs/bxss-bitdefender/">Inside a global leader in CyberSecurity [bitdefender dashboard]</a></li></td>
            
        </tr>
            
            
            
        </table>

    </ul>
</div>
</aside>
<script>
	window.addEventListener('DOMContentLoaded', () => {
		const observerForTableOfContentActiveState = new IntersectionObserver(entries => {
			entries.forEach(entry => {
				const id = entry.target.getAttribute('id');

				if (entry.intersectionRatio > 0) {					
					clearActiveStatesInTableOfContents();				
					document.querySelector(`nav li a[href="#${id}"]`).parentElement.classList.add('active');
				}
			});
		});		
		document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach((section) => {
			observerForTableOfContentActiveState.observe(section);
		});

	});

	function clearActiveStatesInTableOfContents() {
		document.querySelectorAll('nav li').forEach((section) => {
			section.classList.remove('active');
		});
	}
</script>

  <footer>
  
  
  </footer>
  <script>
    
    window.onscroll = function() {myFunction()};

    function myFunction() {
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = (winScroll / height) * 100;
      document.getElementById("myBar").style.width = scrolled + "%";
    }
</script>
  </body>
</html>

