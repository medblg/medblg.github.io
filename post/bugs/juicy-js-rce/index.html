<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Juicy Infos hidden in js scripts leads to RCE | MedBLG - InfoSec Enthusiast | Dev - DevOps - AI</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.2/css/all.css">
    
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <meta property="og:title" content="Juicy Infos hidden in js scripts leads to RCE" />
<meta property="og:description" content="A writeup about a finding that exploits an endpoint in an embedded javascript code, that leads to Account Takeover, then using the admin dashboard to get RCE !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://medblg.top/post/bugs/juicy-js-rce/" />
<meta property="og:image" content="https://medblg.top/images/anVpY3ktanMtcmNlCg==.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="article:published_time" content="2019-01-19T08:00:44+01:00" />
<meta property="article:modified_time" content="2019-01-19T08:00:44+01:00" />

  </head>

  <body>
    
    <div class="progress-container">
      <div class="progress-bar" id="myBar"></div>
    </div>  
    <nav>
    <ul class="menu">
      
      <li><a href="/about">About</a></li>
      
      <li><a href="/">Posts</a></li>
      
      <li><a href="/categories">Categories</a></li>
      
      <li><a href="/tags">Tags</a></li>
      
    </ul>

    <ul class="menu" id="social-links">
    
      <li><a href="https://fb.me/simo.balghaoui"><i class="fa-brands fa-facebook fa-2xl"></i></a></li>

      <li><a href="https://github.com/medblg"><i class="fa-brands fa-github fa-2xl"></i></a></li>

      <li><a href="https://linkedin.com/in/medblg"><i class="fa-brands fa-linkedin-in fa-2xl"></i></a></li>

    </ul>
    
    </div>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Juicy Infos hidden in js scripts leads to RCE</span></h1>

<h2 class="date">Jan. 19, 2019</h2>
</div>


<main>
<figure>
<img class="featured_img" src="/images/anVpY3ktanMtcmNlCg==.png" width="700px" height="250px"/> </figure>
<p>Sorry for the late, I wasn’t able to write this before. Academic exams were overwhelming as usual. Now, I got some time. Let’s start the (story)!
One day, while doing my research as usual, I come across a web application that I (want) to test. Just curious, you know when a website pop up and you as usual with your hacker mind spirit want to test, just a small check list will be enough (as it wasn’t your target at first place). But, even though you begin crossing the walls, and embedding all your abilities and skills, and tied yourself with a small amount of time. Of course, wearing that white hat while doing this is mandatory . ¯\ <em>(ツ)</em>/¯</p>
<p>I located a resource, where users and admins were supposed to enter their credentials. It wasn’t on the main domain. First thing first, was to take a look onto the source code. As all of you knew, JS code is open and it’s a front-end as html source. By the way I like inspecting js code, as it’s the first sensitive code used within some technologies to interact with internal system, and it provides more interactivity to test besides the white-box inspection if available.</p>
<p>The function ChangePassword catched my attention :</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">function</span> ChangePassword(e){
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">var</span> str <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;txtUserId&#34;</span>).value;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">var</span> sub <span style="color:#ff79c6">=</span> str.substr(<span style="color:#bd93f9">0</span>,<span style="color:#bd93f9">3</span>);
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> (sub <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;....&#34;</span>){
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">var</span> url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Change?.....=&#34;</span> <span style="color:#ff79c6">+</span> str;
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">window</span>.open(url, <span style="color:#f1fa8c">&#39;true&#39;</span>, <span style="color:#f1fa8c">&#39;left=0, top, width=800, toolbar=0, scrollbars=0, status=0&#39;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>So, this introduces me to a new relative path with a parameter inside. That was looking promising. Opening the new path with a parameter and a random name as value, shows the change password utility with that given name in parameter.
Till now, I have a forced browser to user’s password change utility and an IDOR. The page shows a disabled field where to put the new password. The bypass was easy as (hacking google in my childhood, with inspecting elements of course ;).</p>
<p>After submitting that form, I got a message telling me that The Username wasn’t found !. Oops, two hypothesis comes to my mind about user’s verification.</p>
<ol>
<li>
<p>What if there is no further check if I entered the correct username, then I will have a <code>Critical Account takeover IDOR</code>.</p>
</li>
<li>
<p>If not 1), how can I bypass it.</p>
</li>
</ol>
<p>Sticking to the first assumption, and back to our js code, looking around. The parameter’s value was just like this : <code>change?pass=user-</code> .</p>
<p>I assumed then that the application assigns an incremented value after the hyphen and thus for every user created. So, how would be great to put the number 1 after <code>user-</code> ? :) the result will be something like this : <code>change?pass=user-1</code> .</p>
<p>The first user is always if not, the administrator. The trick was working, now I have a full Critical IDOR that leads to Account Takeover. And I have an administrator panel with full functionalities. I forgot to mention, this was a dedicated server, it’s belonging to a public college(responsibly not disclosing the name), their official website(System in general), and lot of sensitive information were going on there. It’s a full Content Management System with all college administrative’s stuff, employee attendance, salaries, payments, classes, teacher&rsquo;s section where to put assignment, students grades… . You can even change these grades… and more and more .</p>
<figure>
    <img class="featured_img" src="/images/anVpY3ktanMtcmNlCg2==.png" width="700px" height="350px"/> 
        <figcaption style="margin-top:10px;font-family: sohne, 'Helvetica Neue', Helvetica, Arial, sans-serif;color: rgba(117, 117, 117, 1);">
        Dashboard
        </figcaption></figure>
<p><figure>
    <img class="featured_img" src="/images/anVpY3ktanMtcmNlCg3==.png" width="700px" height="350px"/> 
        <figcaption style="margin-top:10px;font-family: sohne, 'Helvetica Neue', Helvetica, Arial, sans-serif;color: rgba(117, 117, 117, 1);">
        Dashboard functionalities
        </figcaption></figure>
<figure>
    <img class="featured_img" src="/images/anVpY3ktanMtcmNlCg4==.png" width="700px" height="350px"/> 
        <figcaption style="margin-top:10px;font-family: sohne, 'Helvetica Neue', Helvetica, Arial, sans-serif;color: rgba(117, 117, 117, 1);">
        Dashboard functionalities
        </figcaption></figure></p>
<p>It tooks me along with the administrator panel up to 15 min, exploring the web application and its design. And finally getting my RCE on a <code>dedicated server</code> with plenty of actions going on inside. (The opening picture).</p>
<h2 id="nb">NB:</h2>
<p>No malicious act was performed, I contacted the system administrator once I got in. No (index) was changed, either other files were altered. At this time, server is safe and functional.</p>

	
<a class="tag" href="/tags/js">#js</a>
	
<a class="tag" href="/tags/rce">#rce</a>
	
<a class="tag" href="/tags/ato">#ato</a>

</main>
<aside>
<div class="latest-posts">
    <h3 style="text-align: center;">
        Category: 
        
        <a class="cat" href="/categories/bugs">
            bugs
        </a>
        
    </h3>
    <ul>
        
            
            
       <table>
            
            
             
        <tr>
            <th><li style="list-style: none;"><span>Next</span>: </th><td><a href="https://medblg.top/post/bugs/bxss-bitdefender/">Inside a global leader in CyberSecurity [bitdefender dashboard]</a></li></td>
            
        </tr>
            
            
            
            
        </table>

    </ul>
</div>
</aside>
<script>
	window.addEventListener('DOMContentLoaded', () => {
		const observerForTableOfContentActiveState = new IntersectionObserver(entries => {
			entries.forEach(entry => {
				const id = entry.target.getAttribute('id');

				if (entry.intersectionRatio > 0) {					
					clearActiveStatesInTableOfContents();				
					document.querySelector(`nav li a[href="#${id}"]`).parentElement.classList.add('active');
				}
			});
		});		
		document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach((section) => {
			observerForTableOfContentActiveState.observe(section);
		});

	});

	function clearActiveStatesInTableOfContents() {
		document.querySelectorAll('nav li').forEach((section) => {
			section.classList.remove('active');
		});
	}
</script>

  <footer>
  
  
  </footer>
  <script>
    
    window.onscroll = function() {myFunction()};

    function myFunction() {
      var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      var scrolled = (winScroll / height) * 100;
      document.getElementById("myBar").style.width = scrolled + "%";
    }
</script>
  </body>
</html>

